###############################################################################
# Steps
###############################################################################
steps:

  #############################################################################
  # Use Node Version
  #############################################################################
  - task: NodeTool@0
    displayName: "Use Node ${{ parameters.nodeVersion }}"
    inputs:
      versionSpec: "${{ parameters.nodeVersion }}"


  #############################################################################
  # Verify Node
  #############################################################################
  - bash: |
      set -euo pipefail

      node --version
      npm --version
    displayName: "Verify Node"


  #############################################################################
  # Install Dependencies
  #############################################################################
  - bash: |
      set -euo pipefail

      cd "$(System.DefaultWorkingDirectory)/${{ parameters.appName }}/${{ parameters.codePath }}"

      echo ">> Installing dependencies"
      npm install
    displayName: "Install dependencies"


  #############################################################################
  # Test
  #############################################################################
  - bash: |
      set -euo pipefail

      cd "$(System.DefaultWorkingDirectory)/${{ parameters.appName }}/${{ parameters.codePath }}"

      echo ">> Executing tests"
      npx jest --ci --runInBand
      
      rm -rf .reports/*
      cp -R reports/. .reports/
    displayName: "Execute tests"
